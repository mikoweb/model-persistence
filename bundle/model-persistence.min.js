!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("objectmodel"),require("axios")):"function"==typeof define&&define.amd?define(["objectmodel","axios"],e):t.modelPersist=e(t.Model,t.axios)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=(function(){function t(t){this.value=t}function e(e){function n(r,i){try{var u=e[r](i),a=u.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):o(u.done?"return":"normal",u.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?n(r.key,r.arg):i=null}var r,i;this._invoke=function(t,e){return new Promise(function(o,u){var a={key:t,arg:e,resolve:o,reject:u,next:null};i?i=i.next=a:(r=i=a,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),r=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function(){function t(e){if(o(this,t),null===e||"object"!==(void 0===e?"undefined":n(e)))throw new TypeError("expecting object literal");for(var r in e)e.hasOwnProperty(r)&&(this[r]=e[r])}return r(t,[{key:"toJSON",value:function(){return JSON.stringify(this)}}]),t}(),c=function(){function t(){o(this,t)}return r(t,[{key:"defineInterfaceMethod",value:function(){throw new Error("Class should implement this method")}}]),t}(),s=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),r(e,[{key:"locate",value:function(t){this.defineInterfaceMethod()}},{key:"locateById",value:function(t){this.defineInterfaceMethod()}},{key:"getIdPropName",value:function(){this.defineInterfaceMethod()}},{key:"getModelId",value:function(t){this.defineInterfaceMethod()}},{key:"isEmptyModelId",value:function(t){this.defineInterfaceMethod()}},{key:"getModelManagerClass",value:function(){this.defineInterfaceMethod()}},{key:"getRepositoryClass",value:function(){this.defineInterfaceMethod()}},{key:"getInputTransformerClass",value:function(){this.defineInterfaceMethod()}},{key:"getOutputTransformerClass",value:function(){this.defineInterfaceMethod()}}]),e}(),f=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),r(e,[{key:"get",value:function(t,e){this.defineInterfaceMethod()}},{key:"save",value:function(t){this.defineInterfaceMethod()}},{key:"remove",value:function(t){this.defineInterfaceMethod()}}]),e}(),l=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),r(e,[{key:"findOne",value:function(t){this.defineInterfaceMethod()}}]),e}(),h=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),r(e,[{key:"transform",value:function(t){this.defineInterfaceMethod()}}]),e}(),y=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,h),r(e,[{key:"transform",value:function(t){return t}}]),e}(),p=new(function(){function e(){o(this,e)}return r(e,[{key:"getData",value:function(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.isModel(t))throw new TypeError("expecting model to be Model, got "+(void 0===t?"undefined":n(t)));var e={};if(this.isModel(t)){for(var o in t)if(t.hasOwnProperty(o)){"function"==typeof Object.getOwnPropertyDescriptor(t,o).get&&void 0!==t[o]&&(e[o]=this._getObjectValue(t,o))}}else if(this.isRawObject(t))for(var r in t)t.hasOwnProperty(r)&&(e[r]=this._getObjectValue(t,r));return e}},{key:"isModel",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":n(e))&&(e instanceof t||"function"==typeof e.constructor&&e.constructor instanceof t)}},{key:"isRawObject",value:function(t){return null!==t&&"object"===(void 0===t?"undefined":n(t))&&t.constructor===Object}},{key:"_getObjectValue",value:function(t,e){var n=t[e];return this.isRawObject(n)||this.isModel(n)?this.getData(n,!0):n}}]),e}()),d=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,h),r(e,[{key:"transform",value:function(t){var e={};return p.isModel(t)?e=p.getData(t):(t instanceof a||p.isRawObject(t))&&(e=t),e}}]),e}(),v=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,s),r(e,[{key:"getIdPropName",value:function(){return"id"}},{key:"getModelId",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":n(t)))throw new Error("argument is not Object");return t[this.getIdPropName()]}},{key:"isEmptyModelId",value:function(t){var e=this.getModelId(t);return null===e||void 0===e||"string"==typeof e&&0===e.length}},{key:"getInputTransformerClass",value:function(){return y}},{key:"getOutputTransformerClass",value:function(){return d}}]),e}(),g=function(t){function e(t,n){o(this,e);var r=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._locator=t,r._client=n,r}return i(e,f),r(e,[{key:"get",value:function(t,e){var n=this;return new Promise(function(o,r){n._client.get(n._locator.locateById(t),n._getRequestOptions()).then(function(t){o(new e(n.createInputTransformer().transform(t.data)))}).catch(function(t){r(t)})})}},{key:"save",value:function(t){var e=this;return new Promise(function(n,o){var r=e._getRequestOptions({data:e.createOutputTransformer().transform(t)});(e._locator.isEmptyModelId(t)?e._client.post:e._client.put)(e._locator.locate(t),r).then(function(){n(!0)}).catch(function(t){o(t)})})}},{key:"remove",value:function(t){var e=this;return new Promise(function(n,o){e._client.delete(e._locator.locate(t),e._getRequestOptions()).then(function(){n(!0)}).catch(function(t){o(t)})})}},{key:"createInputTransformer",value:function(){return new(this._locator.getInputTransformerClass())}},{key:"createOutputTransformer",value:function(){return new(this._locator.getOutputTransformerClass())}},{key:"_getRequestOptions",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}]),e}(),_=function(t){function e(t,n,r,i){o(this,e);var a=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._modelClass=t,a._locator=n,a._manager=r,a._client=i,a}return i(e,l),r(e,[{key:"findOne",value:function(t){return this._manager.get(t,this._modelClass)}}]),e}(),b=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,v),r(e,[{key:"getBaseURL",value:function(){return""+this.hostPath+this.basePath}},{key:"getUrl",value:function(t){return""+this.getBaseURL()+t}},{key:"locate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isEmptyModelId(t)?this.getBaseURL():this.locateById(this.getModelId(t),e)}},{key:"locateById",value:function(t){return this.getUrl("/"+t)}},{key:"getModelManagerClass",value:function(){return g}},{key:"getRepositoryClass",value:function(){return _}},{key:"hostPath",get:function(){return""}},{key:"basePath",get:function(){throw new Error("basePath should be defined in HTTPLocator")}},{key:"headers",get:function(){return{}}}]),e}(),m=new(function(){function t(){o(this,t),this.options={}}return r(t,[{key:"options",get:function(){return Object.assign({},this._options)},set:function(t){this._options=Object.assign({},t)}}]),t}()),O=function(t){var o={};return null!==t&&"object"===(void 0===t?"undefined":n(t))&&Object.keys(t.headers).length>0&&(o.headers=Object.assign({},t.headers)),e.create(Object.assign({},m.options,o))},k=new(function(){function t(){o(this,t)}return r(t,[{key:"createManager",value:function(t){return new(t.getModelManagerClass())(t,O(t))}},{key:"createRepository",value:function(t,e){return new(e.getRepositoryClass())(t,e,this.createManager(e),O(e))}}]),t}()),j=function(t){function e(){return o(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,h),e}(),w={Interface:c,Model:t,DynamicModel:a,modelHelpers:p,LocatorInterface:s,ModelManagerInterface:f,RepositoryInterface:l,HTTPLocatorAbstract:b,HTTPModelManager:g,HTTPRepository:_,httpFactory:k,http:{createClient:O,config:m},transformer:{TransformerInterface:h,InputTransformer:y,OutputTransformer:d,CustomTransformer:j,mergeTransformers:function(t){return function(e){function n(){return o(this,n),u(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return i(n,h),r(n,[{key:"transform",value:function(e){var n=e;return t.forEach(function(t){n=t.transform(n)}),n}}]),n}()}}};return function t(e){Object.keys(e).forEach(function(o){var r=e[o],i=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(e,o,{enumerable:!0,configurable:!1,writable:!1,value:i.value}),null!==r&&"object"===(void 0===r?"undefined":n(r))&&r.constructor===Object&&t(r)})}(w),w});
//# sourceMappingURL=model-persistence.min.js.map
