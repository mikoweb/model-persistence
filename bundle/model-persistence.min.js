!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("objectmodel"),require("axios")):"function"==typeof define&&define.amd?define(["objectmodel","axios"],e):t.modelPersist=e(t.Model,t.axios)}(this,function(t,e){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t,e=e&&e.hasOwnProperty("default")?e.default:e;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=(function(){function t(t){this.value=t}function e(e){function n(o,i){try{var u=e[o](i),a=u.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):r(u.done?"return":"normal",u.value)}catch(t){r("throw",t)}}function r(t,e){switch(t){case"return":o.resolve({value:e,done:!0});break;case"throw":o.reject(e);break;default:o.resolve({value:e,done:!1})}(o=o.next)?n(o.key,o.arg):i=null}var o,i;this._invoke=function(t,e){return new Promise(function(r,u){var a={key:t,arg:e,resolve:r,reject:u,next:null};i?i=i.next=a:(o=i=a,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},a=function(){function t(e){if(r(this,t),null===e||"object"!==(void 0===e?"undefined":n(e)))throw new TypeError("expecting object literal");for(var o in e)e.hasOwnProperty(o)&&(this[o]=e[o])}return o(t,[{key:"toJSON",value:function(){return JSON.stringify(this)}}]),t}(),c=function(){function t(){r(this,t)}return o(t,[{key:"defineInterfaceMethod",value:function(){throw new Error("Class should implement this method")}}]),t}(),s=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),o(e,[{key:"locate",value:function(t){this.defineInterfaceMethod()}},{key:"locateById",value:function(t){this.defineInterfaceMethod()}},{key:"getIdPropName",value:function(){this.defineInterfaceMethod()}},{key:"getModelId",value:function(t){this.defineInterfaceMethod()}},{key:"isEmptyModelId",value:function(t){this.defineInterfaceMethod()}},{key:"getModelManagerClass",value:function(){this.defineInterfaceMethod()}},{key:"getRepositoryClass",value:function(){this.defineInterfaceMethod()}},{key:"getInputTransformerClass",value:function(){this.defineInterfaceMethod()}},{key:"getOutputTransformerClass",value:function(){this.defineInterfaceMethod()}}]),e}(),f=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),o(e,[{key:"get",value:function(t,e){this.defineInterfaceMethod()}},{key:"save",value:function(t){this.defineInterfaceMethod()}},{key:"remove",value:function(t){this.defineInterfaceMethod()}}]),e}(),l=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),o(e,[{key:"findOne",value:function(t){this.defineInterfaceMethod()}}]),e}(),h=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),o(e,[{key:"transform",value:function(t){this.defineInterfaceMethod()}}]),e}(),y=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,h),o(e,[{key:"transform",value:function(t){return t}}]),e}(),p=new(function(){function e(){r(this,e)}return o(e,[{key:"getData",value:function(t){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&!this.isModel(t))throw new TypeError("expecting model to be Model, got "+(void 0===t?"undefined":n(t)));var e={};if(this.isModel(t)){for(var r in t)if(t.hasOwnProperty(r)){"function"==typeof Object.getOwnPropertyDescriptor(t,r).get&&void 0!==t[r]&&(e[r]=this._getObjectValue(t,r))}}else if(this.isRawObject(t))for(var o in t)t.hasOwnProperty(o)&&(e[o]=this._getObjectValue(t,o));return e}},{key:"isModel",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":n(e))&&(e instanceof t||"function"==typeof e.constructor&&e.constructor instanceof t)}},{key:"isRawObject",value:function(t){return null!==t&&"object"===(void 0===t?"undefined":n(t))&&t.constructor===Object}},{key:"_getObjectValue",value:function(t,e){var n=t[e];return this.isRawObject(n)||this.isModel(n)?this.getData(n,!0):n}}]),e}()),d=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,h),o(e,[{key:"transform",value:function(t){var e={};return p.isModel(t)?e=p.getData(t):(t instanceof a||p.isRawObject(t))&&(e=t),e}}]),e}(),g=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,s),o(e,[{key:"getIdPropName",value:function(){return"id"}},{key:"getModelId",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":n(t)))throw new Error("argument is not Object");return t[this.getIdPropName()]}},{key:"isEmptyModelId",value:function(t){var e=this.getModelId(t);return null===e||void 0===e||"string"==typeof e&&0===e.length}},{key:"getInputTransformerClass",value:function(){return y}},{key:"getOutputTransformerClass",value:function(){return d}}]),e}(),v=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,f),o(e,[{key:"createInputTransformer",value:function(){return new(this._locator.getInputTransformerClass())}},{key:"createOutputTransformer",value:function(){return new(this._locator.getOutputTransformerClass())}}]),e}(),_=function(t){function e(t,n){r(this,e);var o=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o._locator=t,o._client=n,o}return i(e,v),o(e,[{key:"get",value:function(t,e){var n=this;return new Promise(function(r,o){n._client.get(n._locator.locateById(t),n._getRequestOptions()).then(function(t){r(new e(n.createInputTransformer().transform(t.data)))}).catch(function(t){o(t)})})}},{key:"save",value:function(t){var e=this;return new Promise(function(n,r){var o=e._getRequestOptions({data:e.createOutputTransformer().transform(t)});(e._locator.isEmptyModelId(t)?e._client.post:e._client.put)(e._locator.locate(t),o).then(function(){n(!0)}).catch(function(t){r(t)})})}},{key:"remove",value:function(t){var e=this;return new Promise(function(n,r){e._client.delete(e._locator.locate(t),e._getRequestOptions()).then(function(){n(!0)}).catch(function(t){r(t)})})}},{key:"_getRequestOptions",value:function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}]),e}(),m=function(t){function e(t,n,o,i){r(this,e);var a=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._modelClass=t,a._locator=n,a._manager=o,a._client=i,a}return i(e,l),o(e,[{key:"findOne",value:function(t){return this._manager.get(t,this._modelClass)}}]),e}(),b=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,g),o(e,[{key:"getBaseURL",value:function(){return""+this.hostPath+this.basePath}},{key:"getUrl",value:function(t){return""+this.getBaseURL()+t}},{key:"locate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.isEmptyModelId(t)?this.getBaseURL():this.locateById(this.getModelId(t),e)}},{key:"locateById",value:function(t){return this.getUrl("/"+t)}},{key:"getModelManagerClass",value:function(){return _}},{key:"getRepositoryClass",value:function(){return m}},{key:"hostPath",get:function(){return""}},{key:"basePath",get:function(){throw new Error("basePath should be defined in HTTPLocator")}},{key:"headers",get:function(){return{}}}]),e}(),O=new(function(){function t(){r(this,t),this.options={}}return o(t,[{key:"options",get:function(){return Object.assign({},this._options)},set:function(t){this._options=Object.assign({},t)}}]),t}()),k=function(t){var r={};return null!==t&&"object"===(void 0===t?"undefined":n(t))&&Object.keys(t.headers).length>0&&(r.headers=Object.assign({},t.headers)),e.create(Object.assign({},O.options,r))},j=new(function(){function t(){r(this,t)}return o(t,[{key:"createManager",value:function(t){return new(t.getModelManagerClass())(t,k(t))}},{key:"createRepository",value:function(t,e){return new(e.getRepositoryClass())(t,e,this.createManager(e),k(e))}}]),t}()),w=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,h),e}(),P=function(t){function e(t){r(this,e);var n=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._locator=t,n}return i(e,v),o(e,[{key:"get",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=void 0;try{r=this.getSync(t,e,n)}catch(t){return Promise.reject(t)}return Promise.resolve(r)}},{key:"getSync",value:function(t,e){var n=this._locator.storage.getItem(this._locator.locateById(t));if(null===n)throw new TypeError("expecting getItem() to be String, got null");return new e(this.createInputTransformer().transform(JSON.parse(n)))}},{key:"save",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{this.saveSync(t,e)}catch(t){return Promise.reject(t)}return Promise.resolve(!0)}},{key:"saveSync",value:function(t){this._locator.storage.setItem(this._locator.locate(t),JSON.stringify(this.createOutputTransformer().transform(t)))}},{key:"remove",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{this.removeSync(t,e)}catch(t){return Promise.reject(t)}return Promise.resolve(!0)}},{key:"removeSync",value:function(t){this._locator.storage.removeItem(this._locator.locate(t))}}]),e}(),I=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,g),o(e,[{key:"locate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isEmptyModelId(t))throw new Error("Model Id cannot be empty in StorageLocator");return this.locateById(this.getModelId(t),e)}},{key:"locateById",value:function(t){return this.basePath+"/"+t}},{key:"getModelManagerClass",value:function(){return P}},{key:"storage",get:function(){throw new Error("storage should be defined in StorageLocator")}},{key:"basePath",get:function(){throw new Error("basePath should be defined in StorageLocator")}}]),e}(),M=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,I),o(e,[{key:"storage",get:function(){return localStorage}}]),e}(),S=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,I),o(e,[{key:"storage",get:function(){return sessionStorage}}]),e}(),T=function(t){function e(t,n,o){r(this,e);var i=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._modelClass=t,i._locator=n,i._manager=o,i}return i(e,l),o(e,[{key:"findOne",value:function(t){return this._manager.get(t,this._modelClass)}},{key:"findOneSync",value:function(t){return this._manager.getSync(t,this._modelClass)}}]),e}(),C={Interface:c,Model:t,DynamicModel:a,modelHelpers:p,LocatorInterface:s,ModelManagerInterface:f,RepositoryInterface:l,LocatorAbstract:g,ModelManagerAbstract:v,HTTPLocatorAbstract:b,HTTPModelManager:_,HTTPRepository:m,httpFactory:j,StorageLocatorAbstract:I,LocalStorageLocatorAbstract:M,SessionStorageLocatorAbstract:S,StorageModelManager:P,StorageRepository:T,http:{createClient:k,config:O},transformer:{TransformerInterface:h,InputTransformer:y,OutputTransformer:d,CustomTransformer:w,mergeTransformers:function(t){return function(e){function n(){return r(this,n),u(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return i(n,h),o(n,[{key:"transform",value:function(e){var n=e;return t.forEach(function(t){n=t.transform(n)}),n}}]),n}()}}};return function t(e){Object.keys(e).forEach(function(r){var o=e[r],i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(e,r,{enumerable:!0,configurable:!1,writable:!1,value:i.value}),null!==o&&"object"===(void 0===o?"undefined":n(o))&&o.constructor===Object&&t(o)})}(C),C});
//# sourceMappingURL=model-persistence.min.js.map
